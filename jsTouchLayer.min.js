var TouchLayer_Controller=function(){var a=[];var b=function(b){return a[b]!==undefined};var c={touchstart:"ontouchstart"in document.documentElement?"touchstart":"mousedown",touchmove:"ontouchmove"in document.documentElement?"touchmove":"mousemove",touchend:"ontouchend"in document.documentElement?"touchend":"mouseup"};return{bind:function(a,b,d,e){var f=false;if(!a||!b||!d){return}if(e!==undefined){f=e}if(c[b]!==undefined){a.addEventListener(c[b],d,f)}},fire:function(a,c,d){if(!a||!c){return}d.type=a;if(!b(a)){c(d)}},lock:function(b){if(b.length>0){for(var c=0;c<b.length;c++){if(!a[b[c]]){a.push(b[c])}}}},unlock:function(b){var c=[];if(b.length>0){for(var d=0;d<a.length;d++){if(!b[a[d]]){c.push(a[d])}}a=c}},makeReturnData:function(a,b,c){return{originalEvent:a,target:b,data:c}}}};var TouchLayer_TapController=function(a){if(!a.eventName||!a.el||!a.callback){return}var b=new TouchLayer_Controller,c=false,d=false,e=400,f=800,g=1e3,h=10,i=null,j=null,k=null,l=null,m=false,n=true;if(a.preventDefault!==undefined){n=a.preventDefault}var o=function(c){if(a.eventName==="tap"){var d=b.makeReturnData(c,a.el);b.fire("tap",a.callback,d)}if(c.event){c=c.event}var e=(c.changedTouches?c.changedTouches[0]:c).target;if(!e.disabled&&this.fireClickEvent){var f=document.createEvent("MouseEvent");f.initMouseEvent("click",c.bubbles,c.cancelable,document.defaultView,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.metaKey,c.button,c.relatedTarget);f.isSimulated=true;e.dispatchEvent(f)}};var p=function(a){var b=0,c=0;if(a.touches!==undefined){b=a.touches[0].pageX;c=a.touches[0].pageY}else if(a.pageX&&a.pageY){b=a.pageX;c=a.pageY}return Math.abs(b-k)>=h||Math.abs(c-l)>=h};var q=function(c){if(c.originalEvent){c=c.originalEvent}if(n){c.preventDefault();c.stopPropagation()}if(c.touches!==undefined){k=c.touches[0].pageX;l=c.touches[0].pageY}else if(c.pageX&&c.pageY){k=c.pageX;l=c.pageY}m=false;if(a.eventName==="tapstart"){var d=b.makeReturnData(c,a.el);b.fire("tapstart",a.callback,d)}if(a.eventName==="taphold"){j=setTimeout(function(){var d=b.makeReturnData(c,a.el);b.fire("taphold",a.callback,d);j=null},g)}};var r=function(c){if(c.originalEvent){c=c.originalEvent}if(n){c.preventDefault();c.stopPropagation()}if(p(c)&&!m&&k+l>0){if(a.eventName==="tapcancel"){var d=b.makeReturnData(c,a.el);b.fire("tapcancel",a.callback,d)}if(j){clearTimeout(j);j=null}m=true}};var s=function(c){if(c.originalEvent){c=c.originalEvent}if(n){c.preventDefault();c.stopPropagation()}if(!m){o(c);if(i&&c.timeStamp-i<=f){i=null;if(a.eventName==="doubletap"){var g=b.makeReturnData(c,a.el);b.fire("doubletap",a.callback,g)}}else{i=c.timeStamp}if(e&&!d){if(a.eventName==="singletap"){var h=b.makeReturnData(c,a.el);b.fire("singletap",a.callback,h)}d=true;setTimeout(function(){d=false},e)}if(j){clearTimeout(j);j=null}}m=true};b.bind(a.el,"touchstart",q,c);b.bind(a.el,"touchmove",r,c);b.bind(a.el,"touchend",s,c)};var TouchLayer_DragController=function(a){if(!a.eventName||!a.el||!a.callback){return}var b=new TouchLayer_Controller,c=false,d=100,e=true,f=true,g=0,h=0,i=0,j=0,k="",l="",m=false,n=false,o=true;if(a.preventDefault!==undefined){o=a.preventDefault}var p=function(a){return e&&a.absDeltaX>=d||f&&a.absDeltaY>=d};var q=function(a){if(a.originalEvent){a=a.originalEvent}if(o){a.preventDefault();a.stopPropagation()}if(a.touches){g=h=a.touches[0].pageX;i=j=a.touches[0].pageY}else if(a.startX&&a.startY){g=h=a.pageX;i=j=a.pageY}k=l=a.timeStamp;l=a.timeStamp;m=false;n=true};var r=function(c){if(n){if(c.originalEvent){c=c.originalEvent}if(o){c.preventDefault();c.stopPropagation()}var d={startX:g,startY:i,prevX:h,prevY:j,deltaY:0,deltaX:0,absDeltaY:0,absDeltaX:0,deltaTime:c.timeStamp-k};if(c.touches){d.deltaY=c.touches[0].pageY-i;d.deltaX=c.touches[0].pageX-g}else if(c.pageX&&c.pageY){d.deltaY=c.pageY-i;d.deltaX=c.pageX-g}if(d!==undefined){d.absDeltaY=Math.abs(d.deltaY);d.absDeltaX=Math.abs(d.deltaX);if(!m){if((!c.touches||c.touches.length<2)&&p(d)){m=true;if(a.eventName==="dragstart"){var e=b.makeReturnData(c,a.el,d);b.fire("dragstart",a.callback,e)}}}if(a.eventName==="drag"){var f=b.makeReturnData(c,a.el,d);b.fire("drag",a.callback,f);if(c.touches){h=c.touches[0].pageX;j=c.touches[0].pageY}else if(c.pageX&&c.pageY){h=c.pageX;j=c.pageY}}}}};var s=function(c){if(c.originalEvent){c=c.originalEvent}if(o){c.preventDefault();c.stopPropagation()}if(m){if(a.eventName==="dragend"){var d=b.makeReturnData(c,a.el);b.fire("dragend",a.callback,d)}}m=false;n=false};b.bind(a.el,"touchstart",q,c);b.bind(a.el,"touchmove",r,c);b.bind(a.el,"touchend",s,c)};var TouchLayer_SwipeController=function(a){if(!a.eventName||!a.el||!a.callback){return}var b=new TouchLayer_Controller,c=false,d=null,e=null,f=null,g=35,h=1e3,i=false,j=true;if(a.preventDefault!==undefined){j=a.preventDefault}var k=function(a){if(a.originalEvent){a=a.originalEvent}if(j){a.preventDefault();a.stopPropagation()}if(a.touches){e=a.touches[0].pageX;f=a.touches[0].pageY}else if(a.pageX&&a.pageY){e=a.pageX;f=a.pageY}d=a.timeStamp;i=false};var l=function(c){if(c.originalEvent){c=c.originalEvent}if(j){c.preventDefault();c.stopPropagation()}var k=null,l=null;if(c.touches){l=c.touches[0].pageY-f;k=c.touches[0].pageX-e}else if(c.pageX&&c.pageY){l=c.pageY-f;k=c.pageX-e}if(k&&l){var m=Math.abs(l),n=Math.abs(k),o=c.timeStamp-d;if(m-n>3||o>h){i=true}else if(n>g&&n>m){var p={direction:k<0?"left":"right",distance:n,deltaTime:o,deltaX:k,deltaY:l};if(a.eventName==="swipe"){var q=b.makeReturnData(c,a.el,p);b.fire("swipe",a.callback,q);if(j){c.preventDefault();c.stopPropagation()}}i=true}}};b.bind(a.el,"touchstart",k,c);b.bind(a.el,"touchmove",l,c)};var TouchLayer=function(){var a={tapstart:TouchLayer_TapController,tapcancel:TouchLayer_TapController,tap:TouchLayer_TapController,doubletap:TouchLayer_TapController,taphold:TouchLayer_TapController,singletap:TouchLayer_TapController,drag:TouchLayer_DragController,dragstart:TouchLayer_DragController,dragend:TouchLayer_DragController,swipe:TouchLayer_SwipeController},b=[];return{bind:function(c,d,e,f){if(!c||!d||!e){return}if(!f){f={}}if(a[c]){f.eventName=c;f.el=d;f.callback=e;b[b.length]=new a[c](f)}}}}